{%- macro curlies(item) -%}
{{ "{" }}{{ item }}{{ "}" }}
{%- endmacro -%}

{%- macro href(url, text) -%}
\href{{ "{" }}{{ url|replace("#", "\\#")|replace("%", "\\%")|replace("_", "\\_") }}{{ "}" }}{{ curlies(text) }}
{%- endmacro -%}

{%- macro label(text) -%}
\label{{ "{" }}{{ text }}{{ "}" }}
{%- endmacro -%}

{%- macro ndr(text) -%}
\vcdDocRef{{ "{" }}{{ text }}{{ "}" }}
{%- endmacro -%}

{%- macro njr(text) -%}
\vcdJiraRef{{ "{" }}{{ text }}{{ "}" }}
{%- endmacro -%}

{%- macro atmtc(text) -%}
\href{https://jira.lsstcorp.org/secure/Tests.jspa\#/testCase/{{ text }}{{ "}" }}{{ "{" }}{{ text }}{{ "}" }}
{%- endmacro -%}
{%- macro atmtp(text) -%}
\href{https://jira.lsstcorp.org/secure/Tests.jspa\#/testPlan/{{ text }}{{ "}" }}{{ "{" }}{{ text }}{{ "}" }}
{%- endmacro -%}
{%- macro atmcycle(text) -%}
\href{https://jira.lsstcorp.org/secure/Tests.jspa\#/testCycle/{{ text }}{{ "}" }}{{ "{" }}{{ text }}{{ "}" }}
{%- endmacro -%}



% generated from JIRA project {{ metadata.project }}
% using template at {{ metadata.template }}.
% Collecting data for component: "{{ metadata.component }}"
% using docsteady version {{ metadata.docsteady_version }}
% Please do not edit -- update information in Jira instead
%
% This file is meant to be included in LaTeX document in order to provide:
%   - section 3: Summary Information
%   - section 4: VCD
%   - appendix A: Summary Explanations

\section{Summary Information}\label{sec:summary}

The following table gives a summary overview including the relation between test cases results and
requirements and verification elements coverage.


% Summary of Summaries
\begin{longtable}{rcc}
&
\begin{tabular}{@{}l@{}} Requirements \\ Counts \end{tabular} &
\begin{tabular}{@{}l@{}} Verification \\Elements \\ Counts \end{tabular} \\ \hline
{{ coverage[0]["title"] }}  & {{ sum_dict[4][0] }} & {{ sum_dict[2][0] }} \\ \hline
{{ coverage[1]["title"] }}  & {{ sum_dict[4][1] }} & {{ sum_dict[2][1] }} \\ \hline
{{ coverage[2]["title"] }}  & {{ sum_dict[4][2] }} & {{ sum_dict[2][2] }} \\ \hline
{{ coverage[3]["title"] }}  & {{ sum_dict[4][3] }} & {{ sum_dict[2][3] }} \\ \hline
Total: & {{ sum_dict[5][0] }} & {{ sum_dict[5][1] }} \\
\bottomrule
\end{longtable}


Following table provides the Test Cases result summary.

\begin{longtable}{rl}
\multicolumn{2}{c}{\textbf{Test Cases Results}} \\ \hline
{% for r in tcresults %}
  {{ tcresults[ r["id"] ]["name"] }} & {{ sum_dict[0][ r["id"] ] }} \\ \hline
{% endfor %}
%   ----------------------
Total: & {{ sum_dict[5][2] }} \\
\bottomrule
\end{longtable}


{# \subsection{Progress Summary} \label{sec:prosum}

The information contained in this subsection is not relevant for th requirements coverage.
This is a complementary information useful to understand the status of the process, and the work still in progress.

Please refer to the SE confluence page where the Verification Elements and Test Cases workflows are documented.

\begin{longtable}{rl}
\multicolumn{2}{c}{\textbf{Verification Elements per Jira Status}} \\ \hline
{% for s in sum_dict[3] %}
  {{ s[2] }} & {{ s[1] }} \\ \hline
{% endfor %}
%   ----------------------
\bottomrule
\end{longtable}

\begin{longtable}{rl}
\multicolumn{2}{c}{\textbf{Test Cases per Jira Status}} \\ \hline
{% for id in sum_dict[1]["id"] %}
  {{ sum_dict[1]["name"][id] }} & {{ sum_dict[1]["count"][id] }} \\ \hline
{% endfor %}
%   ----------------------
\bottomrule
\end{longtable} #}


\section{VCD}


\afterpage{
{\small
{# \newlength{\LTcapwidthold}
\setlength{\LTcapwidthold}{\LTcapwidth}
\setlength{\LTcapwidth}{\textheight} #}
\begin{longtable}{lllll}
\caption{ {{ metadata.component }} VCD Table.} \\
\toprule
\textbf{Requirement} & \textbf{Verification Element} & \textbf{Test Case} & \textbf{Last Run} & \textbf{Test Status} \\
\toprule
\endhead
{% for req in vcd_dict[1] %}
  \begin{tabular}{@{}l@{}}
  {{ req }} \\ {{ ndr(vcd_dict[1][req]['reqDoc']) }}
  \end{tabular} &
  {% set nve = vcd_dict[1][req]['VEs']| length %}
  {% for ve in vcd_dict[1][req]['VEs'] %}
    {% if loop.index != 1 %}
      &
    {% endif %}
    \begin{tabular}{@{}l@{}}
    {{ ve }} \\ {{ njr(vcd_dict[0][ve]['jkey']) }}
    \end{tabular} &
    {% set ntc = vcd_dict[0][ve]['tcs']| length %}
    {% if ntc == 0 %}
      & & \\
    {% else %}
      {% for tc in vcd_dict[0][ve]['tcs'] %}
        {% if loop.index != 1 %}
          & &
        {% endif %}
        \begin{tabular}{@{}l@{}}
        {{ atmtc(tc) }} \\
        {{ ndr(vcd_dict[0][ve]['tcs'][tc]['tspec']) }}
        \end{tabular} &
        {% if vcd_dict[3][tc]['lastR'] %}
          \begin{tabular}{@{}l@{}}
          {{ vcd_dict[3][tc]['lastR']['exdate'] }} \\
          {% set tpl = vcd_dict[3][tc]['lastR']['tplan'] %}
          {% if tpl != "NA" %}
            {{ ndr(vcd_dict[3][tc]['lastR']['dmtr']) }}
            {\scriptsize {{ atmtp(tpl) }} }
          {% else %}
            {\scriptsize {{ atmcycle(vcd_dict[3][tc]['lastR']['tcycle']) }} }
          {% endif %}
          \end{tabular} &
          \{{ vcd_dict[3][tc]['lastR']['status'] }} \\
        {% else %}
          & \notexec{} \\
        {% endif %}
        {% if loop.index != ntc %}
          \cmidrule{3-5}
        {% endif %}
      {% endfor %}
    {% endif %}
    {% if loop.index != nve %}
      \cmidrule{2-5}
    {% endif %}
  {% endfor %}
  \midrule
{% endfor %}
\label{tab:dmvcd}
\end{longtable}
}
}






{#
\newpage
\newpage
\appendix
\section{Summary Explanations}


\subsection{Coverage Explanation}

The following definitions are valid for both requirements and verification elements.


\subsubsection{ {{ coverage[0]["title"] }} } \label{{ curlies(coverage[0]["label"]) }}

The number of requirements or verification elements not related to any test case.


\subsubsection{ {{ coverage[1]["title"] }} } \label{{ curlies(coverage[1]["label"]) }}

The number of requirements or verification elements related only with not executed test cases.
This includes test cases which status is "In Progress" or "Blocked".


\subsubsection{ {{ coverage[2]["title"] }} } \label{{ curlies(coverage[2]["label"]) }}

The number of requirements or verification elements related with Failed test cases.
This includes requirements or verification elements related with both Passed and Failed test cases.


\subsubsection{ {{ coverage[3]["title"] }} } \label{{ curlies(coverage[3]["label"]) }}

The number of requirements or verification elements related with passed test cases.
This includes requirements or verification elements related with non executed test cases.




\subsection{Test Cases Results} \label{sec:tcresdef}

These definitions are derived from the Jira ATM plugin.


\subsubsection{ {{tcresults[0]["name"] }} } \label{{ curlies(tcresults[0]["label"]) }}

The number of test cases that have:

\begin{itemize}
\item never been executed
\item in progress
\item blocked
\end{itemize}


\subsubsection{ {{tcresults[1]["name"] }} } \label{{ curlies(tcresults[1]["label"]) }}

The number of test cases which result is "Conditionally Passed".


\subsubsection{ {{tcresults[2]["name"] }} } \label{{ curlies(tcresults[2]["label"]) }}

The number of test cases which result is "Failed".


\subsubsection{ {{tcresults[3]["name"] }} } \label{{ curlies(tcresults[3]["label"]) }}

The number of test cases which result is "Passed". #}
