{%- macro href(url, text) -%}
\href{{ "{" }}{{ url|replace("#", "\\#")|replace("%", "\\%")|replace("_", "\\_") }}{{ "}" }}{{ curlies(text) }}
{%- endmacro -%}

\documentclass[DM,lsstdraft,STR,toc]{lsstdoc}
\usepackage{geometry}
\usepackage{longtable,booktabs}

\input meta.tex

\providecommand{\tightlist}{
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

\begin{document}

\def\milestoneName{{ '{' }}{{ testplan.milestone_name }}{{ '}' }}
\def\milestoneId{{ '{' }}{{ testplan.milestone_id }}{{ '}' }}
\def\product{{ '{' }}{{ testplan.product }}{{ '}' }}

\setDocCompact{true}

\title[\milestoneId{}~Test Report]{\milestoneId{} (\milestoneName{})~Test Plan and Report}
\setDocRef{\lsstDocType-\lsstDocNum}
\setDocDate{\vcsdate}
\setDocUpstreamLocation{\url{https://github.com/lsst/lsst-texmf/examples}}
\author{ {{ testplan['owner'] }} }

\input history_and_info.tex


\setDocAbstract{
This is the test plan and report for \milestoneId{} (\milestoneName{}), an LSST DM level 1 milestone pertaining to the \product{}.
}


\maketitle

\section{Introduction}
\label{sect:intro}

\subsection{Objectives}
\label{sect:objectives}

{{ testplan['objective'] }}

\subsection{System Overview}
\label{sect:systemoverview}

{{ testplan['system_overview'] }}

\subsection{References}
\label{sect:references}

\renewcommand{\refname}{}
\bibliography{lsst,refs,books,refs_ads}

\subsection{Document Overview}
\label{sect:docoverview}

The following planning sections are completed before the start of the test activity.
Section \ref{sect:configuration} of this document provides details of the \product{} baseline used for this test, including relevant hardware and software configurations.
Section \ref{sect:personnel} lists the individuals involved in performing the tests.
Section \ref{sect:plannedtestactivities} provides a descriptive list of planned test cases.
Once the above sections are completed, this document can be reviewd in order to ensure that the test activity can start.

Section \ref{sect:testresults} is filled after the test activity is completed.
Its includes  an overview of the resulta in \ref{sect:overview}
while \ref{sect:detailedtestresults} provides more detailed results from each individual test case.

\newpage
\section{Test Configuration}
\label{sect:configuration}

{% if testplan.observing_required %}
Observing is required for this test campaign.
{% else %}
Observing is not required for this test campaign.
{% endif %}


\subsection{Verification Environment}
\label{sect:hwconf}
{% if testplan.verification_environment %}
{{ testplan.verification_environment }}
{% endif %}

{% if testplan.entry_criteria %}
\subsection{Entry Criteria}
{{ testplan.entry_criteria }}
{% endif %}

{% if testplan.exit_criteria %}
\subsection{Exit Criteria}
{{ testplan.exit_criteria }}
{% endif %}

{% if testplan.pmcs_activity %}
\subsection{PMCS Activity}
{{ testplan.pmcs_activity }}
{% endif %}

\newpage
\section{Personnel}
\label{sect:personnel}

Following personnel is involved in the test activity:

\begin{itemize}
\item Test Plan ({{ testplan.key }}) owner: {{ testplan.owner }} ({{ testplan.owner_id }})
\item Test Cycles:
\begin{itemize}
{% for cycle in testcycles %}
  \item {{ cycle_key }}: {{ cycle['owner'] }} ({{ cycle['owner_id'] }})
  \begin{itemize}
  {% for test_item in cycle.test_items %}
    \item Test case {{ test_item.test_case_key }}: {{ test_item.user }} ({{ test_item.user_id }})
  {% endfor %}
  \end{itemize}
{% endfor %}
\end{itemize}
\item Additional Test Personnel involved: None
\end{itemize}

\newpage
\section{Planned Test Activities}
\label{sect:plannedtestactivities}

{% for cycle in testcycles %}

\subsection{{ '{' }}Test Cycle {{ cycle.key }}{{ '}' }}

{{ cycle.name }}

{{ cycle.description }}

{% for cycle_item in cycle.test_items %}

\subsubsection{{ '{' }}{{ cycle_item.test_case_key }}{{ '}' }}

{% set testcase = testcases_map[cycle_item.test_case_key] %}
{{ testcase.objective }}

{% endfor %}

{% endfor %}

\newpage

\section{Test Results}
\label{sect:testresults}

\subsection{Overview of the Test Results}
\label{sect:overview}

\subsubsection{Summary Table}
\label{sect:summarytable}


\begin{longtable} {p{0.2\textwidth}p{0.2\textwidth}p{0.6\textwidth}}
\toprule
{% for cycle in testcycles %}
\multicolumn{3}{c}{ Test Cycle {\bf {{ cycle['key'] }}: {{ cycle['name'] }} }} \\\hline
{\bf \footnotesize test case id} & {\bf \footnotesize status} & {\bf \footnotesize comment} \\\toprule
{% for test_item in cycle.test_items %}
{{ test_item['test_case_key'] }} & {{ test_item['status'] }} & {{ test_item['comment'] }} \\\hline
{% endfor %}
{% endfor %}
\end{longtable}

\subsubsection{Overall Assessment}
\label{sect:overallassessment}


\subsubsection{Recommended Improvements}
\label{sect:recommendations}

\subsection{Detailed Test Results}
\label{sect:detailedtestresults}

\end{document}
