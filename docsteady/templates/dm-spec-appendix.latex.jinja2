{%- macro curlies(item) -%}
{{ "{" }}{{ item }}{{ "}" }}
{%- endmacro -%}

{%- macro href(url, text) -%}
\href{{ "{" }}{{ url|replace("#", "\\#")|replace("%", "\\%")|replace("_", "\\_") }}{{ "}" }}{{ curlies(text) }}
{%- endmacro -%}

% generated from JIRA project {{ metadata.project }}
% using template at {{ metadata.template }}.
% Collecting ATM data from folder: "{{ metadata.folder }}"
% using dosteady version {{ metadata.docsteady_version }}
% Please do not edit -- update information in Jira instead

\section{Traceability} \label{sec:trace}

\subsection{Direct Traceability} \label{sec:directrace}

\scriptsize{
\begin{longtable}[]{rp{6cm}p{2cm}p{2cm}p{1.5cm}p{1.5cm}p{1.5cm}}
\toprule
& Verification Elements & VE Status & VE Assignee &Test Cases & TC Status & TC Owner \tabularnewline
\midrule
\endhead

{% for requirement in requirements_map.values() -%}
    {{ loop.index }} &
    {{ href(requirement.jira_url, requirement.key + " - " + requirement.summary) }}
    {% set testcases_list = requirements_to_testcases[requirement.key] -%}
    & {{ ves[requirement.key]['status'] }} & {{ ves[requirement.key]['assignee'] }}
    {% set ntc = testcases_list|length %}
    {% for tc in testcases_list -%}
        {% if loop.index > 1 %}
            &&&
        {% endif %}
        & 
        \hyperref[{{ tc.lower() }}]{{ curlies(tc) }} 
        & {{ testcases_map[ tc ].status }} & {{ testcases_map[ tc ].owner }}
        \\
        {% if loop.index == ntc  %}
            \hdashline
        {% endif %}
    {% endfor -%}
    
{% endfor %}

\tabularnewline
\bottomrule
\end{longtable}
} % end scriptsize

\subsection{Reverse Tracebility} \label{sec:revtrace}

\scriptsize{
\begin{longtable}[]{rp{7cm}p{8cm}}
\toprule
& Test Cases & Verification Elements \tabularnewline
\midrule
\endhead

{% for tc in testcases_map %}
    {{ loop.index }} &
    \hyperref[{{ tc.lower() }}]{{ curlies(tc) }} - {{ testcases_map[ tc ].name }}& 
    {% if testcases_map[ tc ].requirement_issue_keys|length == 0 %}
        No VE Found \\
    {% else %}
    {% for ve in testcases_map[ tc ].requirement_issue_keys %}
        {% if loop.index > 1 %}
            &&
        {% endif %}
        {{ href(requirements_map[ ve ].jira_url, ve)}} - {{ requirements_map[ ve ].summary }} \\
    {% endfor %}
    {% endif %}
{% endfor %}

\tabularnewline
\bottomrule
\end{longtable}
} % end scriptsize
