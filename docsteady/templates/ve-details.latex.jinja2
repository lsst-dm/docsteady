{%- macro curlies(item) -%}
{{ "{" }}{{ item }}{{ "}" }}
{%- endmacro -%}
{# --------------------------------------------------------------------------------#}
{%- macro href(url, text) -%}
\href{{ "{" }}{{ url|replace("#", "\\#")|replace("%", "\\%")|replace("_", "\\_") }}{{ "}" }}{{ curlies(text) }}
{%- endmacro -%}
{# --------------------------------------------------------------------------------#}
{%- macro label(text) -%}
\label{{ "{" }}{{ text }}{{ "}" }}
{%- endmacro -%}
{# --------------------------------------------------------------------------------#}
{%- macro atmtc(text) -%}
\href{https://jira.lsstcorp.org/secure/Tests.jspa\#/testCase/{{ text }}{{ "}" }}{{ "{" }}{{ text }}{{ "}" }}
{%- endmacro -%}
{# --------------------------------------------------------------------------------#}
{%- macro ref(text) -%}
\ref{{ "{" }}{{ text }}{{ "}" }}
{%- endmacro -%}
{# --------------------------------------------------------------------------------#}
{%- macro write_step(index, from, content) -%}
\multirow{3}{*}{\parbox{1.3cm}{ {{ index }}
    {% if from != "" %}
{\scriptsize from \hyperref[{{ from.lower() }}]{{ curlies(from) }} }
    {% endif %}
} }
& {\small Description} &
\begin{minipage}[t]{13cm}{\scriptsize
{{ content.description }}
\vspace{\dp0}
} \end{minipage} \\ \cdashline{2-3}
& {\small Test Data} &
    {% if content.test_data %}
\begin{minipage}[t]{13cm}{\scriptsize
{{ content.test_data }}
\vspace{\dp0}
} \end{minipage}
    {% endif %}
\\ \cdashline{2-3}
    {% if content.example_code %}
& Example Code &
\begin{minipage}[t]{13cm}{\footnotesize
{{ content.example_code }}
\vspace{\dp0}
} \end{minipage} \\ \cline{2-3}
    {% endif %}
& {\small Expected Result} &
    {% if content.expected_result %}
\begin{minipage}[t]{13cm}{\scriptsize
{{ content.expected_result }}
\vspace{\dp0}
} \end{minipage}
    {% endif %}
\\ \hdashline
{%- endmacro -%}
{# --------------------------------------------------------------------------------#}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% do not edit
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[DM]{lsstdoc}
\usepackage{enumitem}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{arydshln}
\usepackage{afterpage}
\usepackage{pdflscape}
\usepackage{graphicx}
\usepackage{lipsum}

\input{meta.tex}

\author{}

\DeclareRobustCommand{\cmdkey}{\raisebox{-.035em}{\includegraphics[height=.75em]{figures/cmdkey}}}

\begin{document}

\providecommand{\tightlist}{
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

\def\product{LSST Data Management}


\title{Verification Elelements Details for the {{ metadata.subcomponent }} Component in {{ metadata.component }} Subsystem}
\mkshorttitle

This is a detailed view of the Verification Elements and relevant associated information, for the specified subcomponent.
The Verification Elements are baselined as per {\lsstDocType}-{lsstDocNum} and each time a new draft is produced,
this view is updated with the correct information. However, test cases are baselined in other documents, and
will be updated during future test activities. Therefore, in some cases, the  information shown here for the
test cases may be outdated.

\section{Summary Overview}

\begin{longtable}{cccc}
\hline
\textbf{Requirements} & & \textbf{Verification Elements} & \textbf{Test Cases} \\ \hline
{% for req in reqs %}
   {% set nve = reqs[req]|length %}
   {% for vek in reqs[req] %}
      {% set rowloop = loop %}
      {% set ve = velements[vek] %}
      {% for testc in ve.test_cases %}
         {% set tc = test_cases[testc[0]] %}
{% if rowloop.index == 1 and loop.index == 1%} {{ req }} {% endif %} &
{% if loop.index == 1 %}
  {\scriptsize {{ ref(ve.key.lower()) }} } & {{ vek }}({\scriptsize {{ ve.assignee}} })
{% else %}
  &
{% endif %} &
{{ tc.key }} ({\scriptsize {{ tc.owner}} }) \\
      {% endfor %}
{% if rowloop.index != nve %} \cdashline{2-4} {% endif %}
   {% endfor %}
\hline
{% endfor %}
\end{longtable}

\section{Verification Elements Details}
{{ label("sec:ves") }}

The following is the list of verification elements defined in the context of the {{ metadata.subcomponent }} component of the {{ metadata.component }} subsystem.

{% for vek in velements %}
{% set ve = velements[vek] %}
\subsection{[{{ ve.key}}] {{ve.summary}} }{{ label(ve.key.lower()) }}

\begin{longtable}{ccccc}
\hline
\textbf{Jira Link} & \textbf{Assignee} & \textbf{Status} & \textbf{Priority} & \textbf{Test Cases}\\ \hline
\href{{ curlies(ve.jira_url) }}{{ curlies(ve.key) }} &
{{ ve.assignee }} & {{ ve.ve_status }} & {{ ve.ve_priority }} &
\begin{tabular}{c}
  {% for tc in ve.test_cases %}
{{ tc[0] }} \\
  {% endfor %}
\end{tabular}
\\
\hline
\end{longtable}

\textbf{Verification Element Description:} \\
{{ ve.description }}

{\footnotesize
\begin{longtable}{p{3cm}p{13cm}}
\hline
\multicolumn{2}{c}{\textbf{Upstream Requirements}}\\ \hline
Requirement ID & {{ ve.req_id }} \\ \cdashline{1-2}
Requirement Description & {{ ve.req_spec }} \\ \cdashline{1-2}
  {% if ve.req_params|length %}
Requirement Parameters & {{ ve.req_params }} \\ \cdashline{1-2}
  {% endif %}
  {% if ve.req_discussion|length %}
Requirement Discussion & {{ ve.req_discussion }} \\ \cdashline{1-2}
  {% endif %}
Requirement Priority & {{ ve.req_priority }} \\ \cdashline{1-2}
Upper Level Requirement &
\begin{tabular}{cl}
  {% for ureq in ve.upper_reqs %}
{{ ureq[0] }} & {{ ureq[1] }} \\
  {% endfor %}
\end{tabular}
\\ \hline
\end{longtable}
}

  {% for testc in ve.test_cases %}
    {% set tc = test_cases[testc[0]] %}
\subsubsection{[{{ tc.key }}] {{ tc.name }} }

\begin{longtable}{cccccc}
\hline
\multicolumn{6}{c}{\textbf{Test Case Summary}} \\ \hline
\textbf{Jira Link} & \textbf{Owner} & \textbf{Status} & \textbf{Version} & \textbf{Critical Event} &
\textbf{Verification Type} \\ \hline
{{ atmtc(tc.key) }} &
{{ tc.owner }} & {{ tc.status }} & {{ tc.version }} & {{ tc.critical_event }} & {{ tc.verification_type }}
\\ \hline
\end{longtable}

\textbf{Objective:} \\
{{ tc.objective }}

    {% if tc.precondition != "" %}
\textbf{Precondition:} \\
{{ tc.precondition }}
    {% endif %}

    {% if tc.predecessors != "" %}
\textbf{Predecessors:} \\
{{ tc.predecessors }}
    {% endif %}

    {% if tc.test_personnel != "" %}
\textbf{Test Personnel:} \\
{{ tc.test_personnel }}
    {% endif %}

    {% if tc.test_script %}
\textbf{Test Procedure}
    \begin{longtable}[]{p{1.3cm}p{2cm}p{13cm}}
    %\toprule
    Step & \multicolumn{2}{@{}l}{Description, Input Data and Expected Result} \\ \toprule
    \endhead
    {% for step in tc.test_script %}
        {% set rowloop = loop %}
        {% if step.test_case_key %}
            {% set step_testcase = test_cases[step.test_case_key] %}
            {% for substep in step_testcase.test_script %}
                {% set id= rowloop.index|string ~ '-' ~ loop.index|string %}
                {{ write_step(id, step_testcase.key, substep) }}
            {% endfor %}

        {% else %}
            {{ write_step(rowloop.index, "", step) }}
        {% endif %}
        \\ \midrule
    {% endfor %}
    \end{longtable}
    {% endif %}

  {% endfor %}

{% endfor %}

\appendix
\section{References\label{sect:references}}
\renewcommand{\refname}{}
\bibliography{lsst,refs,books,refs_ads,local.bib}

\section{Acronyms \label{sect:acronyms}} % include acronyms.tex generated by the generateAcronyms.py (in texmf/scripts)
\input{acronyms}

\end{document}